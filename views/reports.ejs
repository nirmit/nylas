<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gapi Application - Admin Panel</title>
<link href="http://gapi.anilabsinc.com/assets/admin/css/dataportal.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="http://gapi.anilabsinc.com/assets/admin/css/jquery.filer.css" />

<link href="http://gapi.anilabsinc.com/assets/admin/css/gapi.css" rel="stylesheet" type="text/css">
<link href="http://gapi.anilabsinc.com/assets/admin/css/media-query.css" rel="stylesheet" type="text/css">
<link href="http://gapi.anilabsinc.com/assets/admin/css/style.css" rel="stylesheet" type="text/css" />

<script type="text/javascript" src="http://gapi.anilabsinc.com/assets/admin/js/jquery.js"></script>
<script type="text/javascript" src="http://gapi.anilabsinc.com/assets/admin/js/jquery-ui.js"></script>
<script src="https://ajax.aspnetcdn.com/ajax/jquery.validate/1.13.1/jquery.validate.min.js" type="text/javascript"></script>

<script type="text/javascript">
function fun_hide_msg()
{
	setTimeout(function() {   //calls click event after a certain time
	   $('.close').click();
	}, 5000);
}

// go to list page
function backtolist()
{
	window.location.href = "http://gapi.anilabsinc.com/admin/reports";	
}

/* Function for pagination using AJAX to maintain serch area AND pagesize*/
function show_ajax_cardswith_url(baseurl,fieldname,direction)
{	
	var search_string = $('#search_string').val();
	
	$.ajax({
		url:baseurl,
		data:"baseurl="+baseurl+"&search_string="+search_string,
		type:'POST',
		success:function(res)
		{		 
			$('#table_listing').html($(res).find('#table_listing').html());			
		},
		error:function(res) 
		{
			result = false;			
		}
	});	
} 

/* Function for pagination using AJAX */
function show_ajax_cards(obj)
{
	var finalUrl;		
	var baseurl = obj.id;
	finalUrl = baseurl; // redirect
	
	var search_string = $('#search_string').val();
	
	$.ajax({
		url:finalUrl,
		data:"baseurl="+finalUrl+"&search_string="+search_string,	
		type:'POST',
		success:function(res)
		{
			$('#table_listing').html($(res).find('#table_listing').html());
			$('.research').accordion({header: '.mailinfo', collapsible: true, active: false, heightStyle: "content", icons: null});
		},
		error:function(res) 
		{
			result = false;			
		}
	});
}
 
/* Function to select search area */
function fun_clear()
{	  
	$('#search_string').val('');
	$('#frm_search').submit();
	return false;
} 

$( document ).ajaxStart(function() {
	$("#loading").show();
});

$( document ).ajaxComplete(function() {
	$("#loading").hide();
});

function pullEmails(emailId,emailaddress)
{
	var baseurl = 'http://gapi.anilabsinc.com/admin/emailmessages/pullemails';
	
	$.ajax({
		url:baseurl,
		data:{'email_id': emailId},
		type:'POST',
		success:function(res)
		{		 
			$('#successmsg').html('Email details have been pulled successfully for '+emailaddress+'.');
			fun_hide_msg();	
		},
		error:function(res) 
		{
			result = false;			
		}
	});
}

function pullCalEvents(emailId)
{
	var baseurl = 'http://gapi.anilabsinc.com/admin/emailmessages/pullevents';
	
	$.ajax({
		url:baseurl,
		data:{'email_id': emailId},
		type:'POST',
		success:function(res)
		{		 
			$('#successmsg').html('Events have been pulled successfully.');
			fun_hide_msg();	
		},
		error:function(res) 
		{
			result = false;			
		}
	});
}

function switch_user(id,switcheduserid)
{
	$( '#dialog-confirm-switch' ).dialog
	({
		height:170,
		resizable:false,
		width: 350,
		modal: true,
		closeText: "hide",
		draggable: false,
		buttons: 
		{
			"Yes": function() 
			{		
				var base_url = 'http://gapi.anilabsinc.com/admin/reports';
				var switchURL = base_url+"/switchtouser/";
				
				$.ajax({
					type: 'POST',
					url:switchURL,
					data:{'id': id,'switcheduserid':switcheduserid},
					success:function(data)
					{						
						window.location.href = "http://gapi.anilabsinc.com/admin/dashboard";
					},
					error:function(data)
					{
						result = false;
						document.getElementById('alert-success').style.display = 'none';
						document.getElementById('alert-danger').style.display = 'block';
						$('#dangermsg').html('Error While Switching User.');
						fun_hide_msg();
					},
				});
				$( this ).dialog( "close" );	
			},
			No: function() 
			{
				$( this ).dialog( "close" );
			}
		}
	});	
}

function delete_data(id,imgname='',module='')
{
	if(module=='emailmessages')
	{
		$( '#dialog-confirm-emails' ).dialog
		({
			height:170,
			resizable:false,
			width: 350,
			modal: true,
			closeText: "hide",
			draggable: false,
			buttons: 
			{
				"Delete": function() 
				{		
					var base_url = 'http://gapi.anilabsinc.com/admin/reports';
					var deleteURL = base_url+"/delete/";
					
					$.ajax({
						type: 'POST',
						url:deleteURL,
						data:{'id': id,'img':imgname},
						success:function(data)
						{
							show_ajax_cardswith_url(base_url);
							$('tr[data-id='+id+']').remove();
							document.getElementById('alert-danger').style.display = 'none';
							document.getElementById('alert-success').style.display = 'block';
							$('#successmsg').html(data+' Deleted Successfully.');
							fun_hide_msg();
						},
						error:function(data)
						{
							//alert("No===>"+data);
							result = false;
							document.getElementById('alert-success').style.display = 'none';
							document.getElementById('alert-danger').style.display = 'block';
							$('#dangermsg').html('Error While Deleting Data.');
							fun_hide_msg();
						},
					});
					$( this ).dialog( "close" );		
				},
				Cancel: function() 
				{
					$( this ).dialog( "close" );
				}
			}
		});	
	}
	else
	{
		$( '#dialog-confirm' ).dialog
		({
			height:170,
			resizable:false,
			width: 350,
			modal: true,
			closeText: "hide",
			draggable: false,
			buttons: 
			{
				"Delete": function() 
				{		
					var base_url = 'http://gapi.anilabsinc.com/admin/reports';
					var deleteURL = base_url+"/delete/";
					
					$.ajax({
						type: 'POST',
						url:deleteURL,
						data:{'id': id,'img':imgname},
						success:function(data)
						{
							show_ajax_cardswith_url(base_url);
							$('tr[data-id='+id+']').remove();
							document.getElementById('alert-danger').style.display = 'none';
							document.getElementById('alert-success').style.display = 'block';
							$('#successmsg').html('Data Deleted Successfully.');
							fun_hide_msg();
						},
						error:function(data)
						{
							//alert("No===>"+data);
							result = false;
							document.getElementById('alert-success').style.display = 'none';
							document.getElementById('alert-danger').style.display = 'block';
							$('#dangermsg').html('Error While Deleting Data.');
							fun_hide_msg();
						},
					});
					$( this ).dialog( "close" );		
				},
				Cancel: function() 
				{
					$( this ).dialog( "close" );
				}
			}
		});	
	}	
}

</script>

</head>

<body>
	<header>
		<a href="http://gapi.anilabsinc.com/admin/dashboard"><img src="http://gapi.anilabsinc.com/assets/admin/images/gapi_logo.png" alt="GAPI" title="GAPI" class="hdr-logo"></a>
		<div class="welcome-name">Welcome Sandeep Kapil</div>			</header>
	    <nav class="nav">
		<ul class="menu">
			<li><a href="/dashboard">Dashboard</a></li>
						<li><a href="/mailbox" >Mail Box</a></li>
			<li><a href="/email" >Email Messages</a></li>
			<li><a href="/calendarevent" >Calendar Events</a></li>
			<li><a href="/reports" class="active">Reports</a></li>
		</ul>
	</nav>
	
<style>
#presets a { border-left: solid #666 1px; padding: 0 10px; }
#presets a.first { border-left: none; }
#keyword { width: 300px; }
#fetcher { width: 500px; }
#keyword, #go { font-size: 1.5em; }
#text { width: 100%; height: 100px; }
p.copy { font-size: small; }
#form { font-size: small; position: relative; }
hr { border: none; border-bottom: solid #ccc 1px; }
#angles line, #angles path, #angles circle { stroke: #666; }
#angles text { fill: #333; }
#angles path.drag { fill: #666; cursor: move; }
#angles { text-align: center; margin: 0 auto; width: 350px; }
#angles input, #max { width: 42px; }
</style>
<style>
text {font: 10px sans-serif;}
</style>
	<section>
		<div class="content-wrapper">
  			<h1>Reports</h1>
   			<form name="frm_search" id="frm_search" action="http://gapi.anilabsinc.com/admin/reports" method="post">	
				<div class="search-wrapper"><label>Select</label>
					<select name="search_string" id="search_string" style="width: 250px;" onchange="showEmails(this.value);">
						<option value="">--Select Report--</option>
						<option value="d3cloud" >Word Cloud</option>
						<option value="bubblechart" >Bubble Chart</option>
						<option value="timebubbleline" >Time Bubble Lines</option>
						<option value="stats" >Stats</option>
						<option value="wordfrequency" >Word Frequency Bubble</option>
					</select>
					<select name="search_string1" id="search_string1" style="width: 250px;">
						<option value="">--Select Email--</option>
														<option value="67" >sandeep kapil                                       kapilsandeep7@gmail.com                                                                             </option>
												
					</select>
					<select name="seltype" id="seltype" style="width: 150px;">
						<option value="">--Select Type--</option>
						<option value="all" >All</option>
						<option value="received" >Received</option>
						<option value="sent" >Sent</option>
					</select>
					<select name="selmon" id="selmon" style="width: 150px;">
						<option value="">--Select Month--</option>
						<option value="0" >All</option>
						<option value="01" >January</option>
						<option value="02" >February</option>
						<option value="03" >March</option>
						<option value="04" >April</option>
						<option value="05" >May</option>
						<option value="06" >June</option>
						<option value="07" >July</option>
						<option value="08" >August</option>
						<option value="09" >September</option>
						<option value="10" >October</option>
						<option value="11" >November</option>
						<option value="12" >December</option>
					</select>
					<select name="selyear" id="selyear" style="width: 150px;">
						<option value="">--Select Year--</option>
						<option value="2017" >2017</option>
						<option value="2016" >2016</option>
						<option value="2015" >2015</option>
					</select>
					<button class="btn" type="submit"><i class="fa fa-floppy-o"></i><span>Go</span></button>
					<button class="btn" type="button" onclick="fun_clear();"><i class="fa fa-times"></i><span>Clear</span></button>
				</div>
			</form>
						
						
						
						
					</div>
	</section>
	<script>
		if($("#search_string").val())
		{
			$("#search_string1").show();
			
			$("#seltype").hide();
			$("#selmon").hide();
			$("#selyear").hide();
			
			if($("#search_string").val()=='bubblechart')
			{				
				$("#seltype").show();
			}
			
			if($("#search_string").val()=='timebubbleline')
			{
				$("#selmon").show();
				$("#selyear").show();
			}
		}
		else
		{
			$("#search_string1").hide();
			$("#seltype").hide();
			$("#selmon").hide();	
			$("#selyear").hide();
		}
		
		function showEmails(e)
		{
			if(e=='')
			{
				$("#search_string1").val('');
				$("#search_string1").hide();
				$("#seltype").hide();
				$("#selmon").hide();
				$("#selmon").val('');
				$("#selyear").hide();
			}
			else
			{
				$("#search_string1").show();
				$("#seltype").hide();
				$("#selmon").hide();
				$("#selmon").val('');
				$("#selyear").hide();
								
				if(e=='bubblechart')
				{
					$("#seltype").show();
				}
				
				if(e=='timebubbleline')
				{
					$("#selmon").show();
					$("#selyear").show();
				}
			}
		}
		
		$("#frm_search").validate({
			ignore:":hidden",
			rules :{
				search_string: {required: true},
				search_string1: {required: true},
				seltype: {required: true},
				selmon: {required: true},		
				selyear: {required: true}
			},
			messages: {
				search_string :{required :"Please select report type"},
				search_string1 :{required :"Please select email"},
				seltype: {required: "Please select type"},
				selmon :{required :"Please select month"},
				selyear :{required :"Please select year"}
			},
			errorElement: "em"
		});
	</script>
	<footer>
		<a href="http://www.anilabsinc.com" target="_blank">anilabsinc.com</a> <span>|</span> <a href="http://gapi.anilabsinc.com/admin/logout">Logout</a>
	</footer>
	<div id="dialog-confirm" title="Delete" style="display:none;"><p>Are you sure you want to delete this?</p></div>
	<div id="dialog-confirm-emails" title="Delete" style="display:none;"><p>All relevant email messages will be deleted. Are you sure you want to delete this?</p></div>	
	<div id="dialog-confirm-switch" title="Switch User" style="display:none;"><p>Are you sure you want to switch with this user?</p></div>
</body>
</html>